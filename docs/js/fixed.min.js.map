{"version":3,"sources":["fixed.js"],"names":["window","header_fixed","id","opts","CLS_STICKY","CLS_FLOATING","CLS_OFFSET","minWindowWidth","maxHeaderHeightRate","elm","elmTop","elmPh","isEnabled","resizeListeners","scrollListeners","throttle","fn","isRunning","run","requestAnimationFrame","getWpAdminBarHeight","e","document","getElementById","getComputedStyle","position","offsetHeight","onResizeHandler","flag","parentNode","insertBefore","classList","add","remove","removeChild","style","top","transform","setEnabled","innerWidth","innerHeight","clientHeight","getBoundingClientRect","pageYOffset","adjustFloating","update","contains","setFloating","origBcrTop","relativeOffsetTop","offset","ancestor","target","addEventListener","l","passive","getElementsByClassName","createElement","doFirst","push","onResize","onScroll"],"mappings":"AAAA,aAUAA,OAAM,KAAWA,OAAM,MAAY,GAGnCA,OAAM,KAASC,aAAe,SAAUC,EAAK,KAAMC,EAAO,IACzD,MAGMC,EAAe,SACfC,EAAe,WACfC,EAAe,SAEfC,EAAsBJ,EAAI,gBAA2B,IACrDK,EAAsBL,EAAI,qBAA2B,GAE3D,IAAIM,EACAC,EAEAC,EACAC,GAAY,EAgBhB,MAAMC,EAAkB,GAClBC,EAAkB,GA0ExB,SAASC,EAASC,GACjB,IAAIC,EACJ,SAASC,IACRD,GAAY,EACZD,IAED,MAAO,KACFC,IACJA,GAAY,EACZE,sBAAsBD,KAQxB,SAASE,IACR,MAAMC,EAAIC,SAASC,eAAe,cAClC,OAAQF,GAAsC,UAAjCG,iBAAiBH,GAAGI,SAAwBJ,EAAEK,aAAe,EAmB3E,SAASC,KAQT,SAAoBC,GACnB,GAAIA,IAAShB,EAAW,OACpBgB,GACHnB,EAAIoB,WAAWC,aAAanB,EAAOF,GACnCA,EAAIsB,UAAUC,IAAI5B,KAElBK,EAAIsB,UAAUE,OAAO7B,EAAYC,EAAcC,GAC/CG,EAAIoB,WAAWK,YAAYvB,GAC3BF,EAAI0B,MAAMC,IAAM,KAChB3B,EAAI0B,MAAME,UAAY,MAEvBzB,EAAYgB,EAlBZU,GA4DItC,OAAOuC,WAAahC,GACpBP,OAAOwC,YAAchC,EAAsBE,EAAO+B,eA5DlD7B,KAoBL,WACC,MAAMwB,EAAMzB,EAAM+B,wBAAwBN,IAAMpC,OAAO2C,YACvDlC,EAAI0B,MAAMC,IAAMA,EAAM,KArBrBQ,GACAC,KAuBF,SAASA,IACR,IAAKjC,EAAW,QAejB,SAAqBgB,GACpB,GAAInB,EAAIsB,UAAUe,SAASzC,KAAkBuB,EAAM,OAC/CA,EACHnB,EAAIsB,UAAUC,IAAI3B,GAElBI,EAAIsB,UAAUE,OAAO5B,GAnBtB0C,CAAmC,IAAvB/C,OAAO2C,aAEnB,MAAMK,EAAarC,EAAM+B,wBAAwBN,IAEjD,GADYY,EAAaC,EAAkBxC,EAAKC,IACrCU,IAAuB,CACjC,MAAM8B,EAASF,EAAaC,EAAkBxC,EAAKC,GAAUV,OAAO2C,YAAcvB,IAClFX,EAAI0B,MAAME,UAAa,eAAca,OACrCzC,EAAIsB,UAAUC,IAAI1B,QAElBG,EAAI0B,MAAME,UAAY,KACtB5B,EAAIsB,UAAUE,OAAO3B,GAiBvB,SAAS2C,EAAkBE,EAAUC,GACpC,OAAOA,EAAOV,wBAAwBN,IAAMe,EAAST,wBAAwBN,IArG9Ed,SAAS+B,iBAAiB,oBAAoB,KAC7CrD,OAAOqD,iBAAiB,UAAU,KAAQ,IAAK,MAAMC,KAAKzC,EAAiByC,MAAQ,CAAEC,SAAS,IAC9FvD,OAAOqD,iBAAiB,UAAU,KAAQ,IAAK,MAAMC,KAAKxC,EAAiBwC,MAAQ,CAAEC,SAAS,OA+B/FjC,SAAS+B,iBAAiB,oBAAoB,WAC7C5C,EAAMa,SAASkC,uBArII,eAqI4B,GAC/C9C,EAASY,SAASkC,uBArIC,mBAqImC,GACjD/C,GAAQC,IAEbC,EAAQW,SAASmC,cAAc,OAxGhC,SAAkBzC,EAAI0C,GAAU,GAC3BA,GAAS1C,IACbH,EAAgB8C,KAAK5C,EAASC,IAwG9B4C,CAASjC,GAAiB,GArG3B,SAAkBX,EAAI0C,GAAU,GAC3BA,GAAS1C,IACbF,EAAgB6C,KAAK5C,EAASC,IAoG9B6C,CAAShB,GAAQ","file":"fixed.min.js","sourcesContent":["/**\n *\n * Gida Header - Fixed (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-09-30\n *\n */\n\n\nwindow['GIDA'] = window['GIDA'] ?? {};\n\n\nwindow['GIDA'].header_fixed = function (id = null, opts = {}) {\n\tconst CLS_ELM     = 'gida-header';\n\tconst CLS_ELM_TOP = 'gida-header-top';\n\n\tconst CLS_STICKY   = 'sticky';\n\tconst CLS_FLOATING = 'floating';\n\tconst CLS_OFFSET   = 'offset';\n\n\tconst minWindowWidth      = opts['minWindowWidth']      ?? 600;\n\tconst maxHeaderHeightRate = opts['maxHeaderHeightRate'] ?? 0.2;\n\n\tlet elm;\n\tlet elmTop;\n\n\tlet elmPh;\n\tlet isEnabled = false;\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t *\n\t * Common Functions (JS)\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-09-30\n\t *\n\t */\n\t\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\t// const scrollableDetectionTargets = [];\n\t\n\t// function addScrollableDetectionTarget(tar) {\n\t// \tscrollableDetectionTargets.push(tar);\n\t// }\n\t\n\t// function initializeScrollableDetection() {\n\t// \tconst rob = new ResizeObserver(oes => {\n\t// \t\tfor (const oe of oes) detectScrollable(oe.target);\n\t// \t});\n\t// \tfor (const tar of scrollableDetectionTargets) {\n\t// \t\trob.observe(tar);\n\t// \t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\n\t// \t}\n\t// }\n\t\n\t// function detectScrollable(elm) {\n\t// \tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\n\t// \t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\n\t// \t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\n\t// \t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\n\t// \t} else {\n\t// \t\telm.classList.remove('scrollable-right');\n\t// \t\telm.classList.remove('scrollable-left');\n\t// \t}\n\t// }\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\t// function addHoverStateEventListener(items, clsCurrent, clsHover) {\n\t// \tconst enter = (e) => {\n\t// \t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t// \t\t\te.target.classList.add(clsHover);\n\t// \t\t}\n\t// \t}\n\t// \tconst leave = (e) => {\n\t// \t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t// \t\t\te.target.classList.remove(clsHover);\n\t// \t\t}\n\t// \t}\n\t// \tfor (const it of items) {\n\t// \t\tit.addEventListener('pointerenter', enter);\n\t// \t\tit.addEventListener('pointerleave', leave);\n\t// \t}\n\t// }\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t\t// initializeScrollableDetection();\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction getWpAdminBarHeight() {\n\t\tconst e = document.getElementById('wpadminbar');\n\t\treturn (e && getComputedStyle(e).position === 'fixed') ? e.offsetHeight : 0;\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tdocument.addEventListener('DOMContentLoaded', function () {\n\t\telm = document.getElementsByClassName(CLS_ELM)[0];\n\t\telmTop = document.getElementsByClassName(CLS_ELM_TOP)[0];\n\t\tif (!elm || !elmTop) return;\n\n\t\telmPh = document.createElement('div');\n\n\t\tonResize(onResizeHandler, true);\n\t\tonScroll(update, true);\n\t});\n\n\tfunction onResizeHandler() {\n\t\tsetEnabled(isStickable());\n\t\tif (isEnabled) {\n\t\t\tadjustFloating();\n\t\t\tupdate();\n\t\t}\n\t}\n\n\tfunction setEnabled(flag) {\n\t\tif (flag === isEnabled) return;\n\t\tif (flag) {\n\t\t\telm.parentNode.insertBefore(elmPh, elm);\n\t\t\telm.classList.add(CLS_STICKY);\n\t\t} else {\n\t\t\telm.classList.remove(CLS_STICKY, CLS_FLOATING, CLS_OFFSET);\n\t\t\telm.parentNode.removeChild(elmPh);\n\t\t\telm.style.top = null;\n\t\t\telm.style.transform = null;\n\t\t}\n\t\tisEnabled = flag;\n\t}\n\n\tfunction adjustFloating() {\n\t\tconst top = elmPh.getBoundingClientRect().top + window.pageYOffset;\n\t\telm.style.top = top + 'px';\n\t}\n\n\tfunction update() {\n\t\tif (!isEnabled) return;\n\t\tsetFloating(window.pageYOffset !== 0);\n\n\t\tconst origBcrTop = elmPh.getBoundingClientRect().top;\n\t\tconst top = origBcrTop + relativeOffsetTop(elm, elmTop);\n\t\tif (top <= getWpAdminBarHeight()) {\n\t\t\tconst offset = origBcrTop + relativeOffsetTop(elm, elmTop) + window.pageYOffset - getWpAdminBarHeight();\n\t\t\telm.style.transform = `translateY(-${offset}px)`;\n\t\t\telm.classList.add(CLS_OFFSET);\n\t\t} else {\n\t\t\telm.style.transform = null;\n\t\t\telm.classList.remove(CLS_OFFSET);\n\t\t}\n\t}\n\n\tfunction setFloating(flag) {\n\t\tif (elm.classList.contains(CLS_FLOATING) === flag) return;\n\t\tif (flag) {\n\t\t\telm.classList.add(CLS_FLOATING);\n\t\t} else {\n\t\t\telm.classList.remove(CLS_FLOATING);\n\t\t}\n\t}\n\n\n\t// Common ------------------------------------------------------------------\n\n\n\tfunction relativeOffsetTop(ancestor, target) {\n\t\treturn target.getBoundingClientRect().top - ancestor.getBoundingClientRect().top;\n\t}\n\n\tfunction isStickable() {\n\t\tif (window.innerWidth < minWindowWidth) return false;\n\t\tif (window.innerHeight * maxHeaderHeightRate < elmTop.clientHeight) return false;\n\t\treturn true;\n\t}\n\n};\n"]}