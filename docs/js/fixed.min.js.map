{"version":3,"sources":["fixed.js"],"names":["window","header_fixed","id","arguments","length","undefined","opts","CLS_ELM","CLS_ELM_TOP","CLS_STICKY","CLS_FLOATING","CLS_OFFSET","minWindowWidth","maxHeaderHeightRate","minSwitchingOffset","minSwitchingTime","scrollPaddingOffset","margin","elm","elmTop","isEnabled","cmsBarHeight","lastSwitchedY","lastSwitchedT","Number","MAX_SAFE_INTEGER","origTop","origMid","offsetTop","safePaddingOffset","vhd","isIos","navigator","userAgent","match","platform","maxTouchPoints","initializeScrollPaddingTop","html","document","documentElement","getAttribute","setAttribute","MutationObserver","updateScrollPaddingTop","observe","attributes","v","parseInt","getComputedStyle","scrollPaddingTop","setScrollPaddingTop","isNaN","key","val","a","vs","Map","split","map","e","set","delete","Array","from","join","getScrollPaddingTop","without","filter","_ref","_ref2","k","reduce","b","style","resizeListeners","scrollListeners","onResize","fn","doFirst","push","throttle","onScroll","onLoad","readyState","addEventListener","setTimeout","isRunning","run","requestAnimationFrame","getStaticBoundingClientRect","origPos","position","r","getBoundingClientRect","remainingHeight","ancestor","target","top","getCmsBarHeight","parseFloat","marginTop","getViewHeightDifference","de","createElement","opacity","height","body","appendChild","clientHeight","removeChild","scrollToHash","hash","location","t","getElementById","substring","spt","scrollTo","pageYOffset","onResizeHandler","setEnabled","isStickable","adjustFloating","update","flag","classList","add","remove","rh","scrollY","Math","ceil","bottom","force","setFloating","setOffset","po","contains","abs","performance","now","innerWidth","innerHeight","l","passive","getElementsByClassName"],"mappings":"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","file":"fixed.min.js","sourcesContent":["/**\n * Gida Header - Fixed\n *\n * @author Takuto Yanagida\n * @version 2022-07-27\n */\n\n\nwindow['GIDA'] = window['GIDA'] ?? {};\n\n\nwindow['GIDA'].header_fixed = function (id = null, opts = {}) {\n\tconst CLS_ELM     = 'gida-header';\n\tconst CLS_ELM_TOP = 'gida-header-top';\n\n\tconst CLS_STICKY   = 'sticky';\n\tconst CLS_FLOATING = 'floating';\n\tconst CLS_OFFSET   = 'offset';\n\n\tconst minWindowWidth      = opts['minWindowWidth']      ?? 600;\n\tconst maxHeaderHeightRate = opts['maxHeaderHeightRate'] ?? 0.2;\n\tconst minSwitchingOffset  = opts['minSwitchingOffset']  ?? 100;\n\tconst minSwitchingTime    = opts['minSwitchingTime']    ?? 200;\n\tconst scrollPaddingOffset = opts['scrollPaddingOffset'] ?? 8;\n\tconst margin              = opts['margin']              ?? 100;\n\n\tlet elm;\n\tlet elmTop;\n\n\tlet isEnabled     = false;\n\tlet cmsBarHeight  = 0;\n\tlet lastSwitchedY = 0;\n\tlet lastSwitchedT = Number.MAX_SAFE_INTEGER;\n\tlet origTop       = 0;\n\tlet origMid       = 0;\n\tlet offsetTop     = 0;\n\n\tlet safePaddingOffset = 0;\n\tlet vhd               = 0;\n\tconst isIos = null !== navigator.userAgent.match(/iPad|iPhone|iPod/) || (navigator.platform === 'MacIntel' && 1 < navigator.maxTouchPoints);\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Scroll Padding Top\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-01-07\n\t */\n\t\n\t\n\tfunction initializeScrollPaddingTop() {\n\t\tconst html = document.documentElement;\n\t\tif (html.getAttribute('data-scroll-padding-top') !== null) return;\n\t\thtml.setAttribute('data-scroll-padding-top', '');\n\t\n\t\tconst mo = new MutationObserver(updateScrollPaddingTop);\n\t\tmo.observe(html, { attributes: true });\n\t\n\t\tconst v = parseInt(getComputedStyle(html).scrollPaddingTop);\n\t\tsetScrollPaddingTop('default', Number.isNaN(v) ? 0 : v);\n\t}\n\t\n\tfunction setScrollPaddingTop(key, val) {\n\t\tconst html = document.documentElement;\n\t\tconst a    = html.getAttribute('data-scroll-padding-top');\n\t\tconst vs   = a ? new Map(a.split(',').map(e => e.split(':'))) : new Map();\n\t\tif (val) {\n\t\t\tvs.set(key, val);\n\t\t} else {\n\t\t\tvs.delete(key);\n\t\t}\n\t\thtml.setAttribute('data-scroll-padding-top', Array.from(vs).map(e => e.join(':')).join(','));\n\t\tupdateScrollPaddingTop();\n\t}\n\t\n\tfunction getScrollPaddingTop(without = null) {\n\t\tconst html = document.documentElement;\n\t\tconst a    = html.getAttribute('data-scroll-padding-top');\n\t\tif (!a) return 0;\n\t\n\t\tconst vs = a.split(',').map(e => e.split(':')).filter(([key,]) => key !== without).map(([k, v]) => parseInt(v));\n\t\treturn vs.reduce((a, b) => a + b, 0);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction updateScrollPaddingTop() {\n\t\tconst html = document.documentElement;\n\t\thtml.style.scrollPaddingTop = getScrollPaddingTop() + 'px';\n\t}\n\t\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-07-27\n\t */\n\t\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onLoad(fn) {\n\t\tif ('loading' === document.readyState) {\n\t\t\tdocument.addEventListener('DOMContentLoaded', fn);\n\t\t} else {\n\t\t\tsetTimeout(fn, 0);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tonLoad(() => {\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction getStaticBoundingClientRect(elm) {\n\t\tconst origPos = elm.style.position;\n\t\telm.style.position = 'static';\n\t\tconst r = elm.getBoundingClientRect();\n\t\telm.style.position = origPos;\n\t\treturn r;\n\t}\n\t\n\tfunction remainingHeight(ancestor, target) {\n\t\treturn target.getBoundingClientRect().top - ancestor.getBoundingClientRect().top;\n\t}\n\t\n\tfunction getCmsBarHeight() {\n\t\treturn parseFloat(getComputedStyle(document.documentElement).marginTop);\n\t}\n\t\n\tfunction getViewHeightDifference() {\n\t\tconst de = document.createElement('div');\n\t\tde.style.opacity  = 0;\n\t\tde.style.position = 'absolute';\n\t\tde.style.height   = 'calc(100lvh - 100svh)';\n\t\tdocument.body.appendChild(de);\n\t\tconst vhd = de.clientHeight;\n\t\tdocument.body.removeChild(de);\n\t\treturn vhd;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction scrollToHash() {\n\t\tconst hash = window.location.hash;\n\t\tif (!hash || hash.length < 2 || '#' !== hash[0]) return;\n\t\tconst t = document.getElementById(hash.substring(1));\n\t\tif (!t) return;\n\t\tsetTimeout(() => {\n\t\t\tconst spt = parseInt(document.documentElement.style.scrollPaddingTop, 10);\n\t\t\twindow.scrollTo(0, t.getBoundingClientRect().top + window.pageYOffset - spt);\n\t\t}, 0);\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tonLoad(() => {\n\t\tinitializeScrollPaddingTop();\n\t\tvhd = isIos ? getViewHeightDifference() : 0;\n\n\t\telm = id ? document.getElementById(id) : document.getElementsByClassName(CLS_ELM)[0];\n\t\tif (!elm) return;\n\t\telmTop = elm.getElementsByClassName(CLS_ELM_TOP)[0] ?? elm;\n\n\t\tonResize(onResizeHandler, true);\n\t\tonScroll(update, true);\n\n\t\tscrollToHash();\n\t});\n\n\tfunction onResizeHandler() {\n\t\tsetEnabled(isStickable());\n\t\tif (isEnabled) {\n\t\t\tcmsBarHeight = getCmsBarHeight();\n\t\t\tadjustFloating();\n\t\t\tupdate(true);\n\t\t}\n\t}\n\n\tfunction setEnabled(flag) {\n\t\tif (flag === isEnabled) return;\n\t\tif (flag) {\n\t\t\telm.classList.add(CLS_STICKY);\n\t\t\telm.style.position = 'sticky';\n\t\t} else {\n\t\t\telm.classList.remove(CLS_STICKY, CLS_FLOATING, CLS_OFFSET);\n\t\t\telm.style.position = null;\n\t\t\telm.style.top      = null;\n\n\t\t\tsetScrollPaddingTop('gida-header', null);\n\t\t}\n\t\tisEnabled = flag;\n\t}\n\n\tfunction adjustFloating() {\n\t\tconst r  = getStaticBoundingClientRect(elm);\n\t\tconst rh = remainingHeight(elm, elmTop);\n\n\t\torigTop   = r.top + window.scrollY;\n\t\torigMid   = r.top + window.scrollY + rh;\n\t\toffsetTop = Math.ceil(cmsBarHeight - rh);\n\n\t\tsafePaddingOffset = Math.ceil(r.bottom + window.scrollY + scrollPaddingOffset);\n\t}\n\n\tfunction update(force = false) {\n\t\tif (!isEnabled) return;\n\t\tsetFloating(10 < window.pageYOffset);\n\t\tsetOffset(origMid + margin <= window.scrollY + cmsBarHeight, force);\n\n\t\tsetTimeout(() => {\n\t\t\tlet po = safePaddingOffset;\n\t\t\tif (elm.classList.contains(CLS_OFFSET)) {\n\t\t\t\tpo = Math.ceil(elm.getBoundingClientRect().height + offsetTop + scrollPaddingOffset);\n\t\t\t}\n\t\t\tsetScrollPaddingTop('gida-header', po + vhd);\n\t\t}, 0);\n\t}\n\n\tfunction setFloating(flag) {\n\t\tif (elm.classList.contains(CLS_FLOATING) === flag) return;\n\t\tif (flag) {\n\t\t\telm.classList.add(CLS_FLOATING);\n\t\t} else {\n\t\t\telm.classList.remove(CLS_FLOATING);\n\t\t}\n\t}\n\n\tfunction setOffset(flag, force) {\n\t\tif (!force) {\n\t\t\tif (elm.classList.contains(CLS_OFFSET) === flag) return;\n\t\t\tif (Math.abs(lastSwitchedY - window.scrollY) <= minSwitchingOffset) return;\n\t\t\tlastSwitchedY = window.scrollY;\n\t\t\tif (Math.abs(lastSwitchedT - performance.now()) <= minSwitchingTime) return;\n\t\t\tlastSwitchedT = performance.now();\n\t\t}\n\t\tif (flag) {\n\t\t\telm.classList.add(CLS_OFFSET);\n\t\t\telm.style.top = offsetTop + 'px';\n\t\t} else {\n\t\t\telm.classList.remove(CLS_OFFSET);\n\t\t\telm.style.top = origTop + 'px';\n\t\t}\n\t}\n\n\n\t// Common ------------------------------------------------------------------\n\n\n\tfunction isStickable() {\n\t\tif (window.innerWidth < minWindowWidth) return false;\n\t\tif (window.innerHeight * maxHeaderHeightRate < elmTop.clientHeight) return false;\n\t\treturn true;\n\t}\n\n};\n"]}